<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>ƒêƒÉng s·∫£n ph·∫©m</title>
  <style>
    /* ... gi·ªØ nguy√™n style nh∆∞ b·∫°n ƒë√£ c√≥ ... */
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f4f4;
      padding: 40px;
    }
    .form-container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
    }
    input[readonly] {
      background-color: #eee;
    }
    button {
      width: 100%;
      padding: 12px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover {
      background-color: #0056b3;
    }
    #result {
      text-align: center;
      margin-top: 15px;
      font-weight: bold;
    }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <div class="form-container">
    <h2>üì¶ ƒêƒÉng s·∫£n ph·∫©m m·ªõi</h2>
    <form id="productForm">
      <label for="name">T√™n s·∫£n ph·∫©m</label>
      <input type="text" id="name" required>

      <label for="code">M√£ s·∫£n ph·∫©m (t·ª± sinh)</label>
      <input type="text" id="code" readonly required>

      <label for="price">Gi√°</label>
      <input type="number" id="price" required>

      <label for="discount">Gi√° gi·∫£m (n·∫øu c√≥)</label>
      <input type="number" id="discount">

      <label for="type">Lo·∫°i s·∫£n ph·∫©m</label>
      <select id="type" required>
        <option value="">-- Ch·ªçn lo·∫°i --</option>
        <option value="√°o">√Åo</option>
        <option value="qu·∫ßn">Qu·∫ßn</option>
        <option value="v√°y">V√°y</option>
        <option value="ƒë·∫ßm">ƒê·∫ßm</option>
        <option value="kh√°c">Kh√°c</option>
      </select>

      <label for="gender">Gi·ªõi t√≠nh</label>
      <select id="gender" required>
        <option value="">-- Ch·ªçn gi·ªõi t√≠nh --</option>
        <option value="nam">Nam</option>
        <option value="n·ªØ">N·ªØ</option>
        <option value="tr·∫ª em">Tr·∫ª em</option>
        <option value="unisex">Unisex</option>
      </select>

      <label for="material">Ch·∫•t li·ªáu</label>
      <select id="material" required>
        <option value="">-- Ch·ªçn ch·∫•t li·ªáu --</option>
        <option value="cotton">Cotton</option>
        <option value="l·ª•a">L·ª•a</option>
        <option value="lenin">Lenin</option>
        <option value="jeans">Jeans</option>
        <option value="n·ªâ">N·ªâ</option>
        <option value="kh√°c">Kh√°c</option>
      </select>

      <label for="imageFile">·∫¢nh s·∫£n ph·∫©m (t·ª± sinh URL)</label>
      <input type="file" id="imageFile" accept="image/*" required>

      <input type="hidden" id="image"> <!-- URL ·∫£nh sau khi upload -->

      <button type="submit">G·ª≠i</button>
      <p id="result"></p>
    </form>
  </div>

<script>
  const imgbbAPIKey = "a8de3a3280c2f3c7f238e2b043cc08c9"; // <- thay b·∫±ng API key th·∫≠t c·ªßa b·∫°n

  function generateProductCode() {
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const numbers = "0123456789";
    let code = "";
    for (let i = 0; i < 2; i++) code += letters.charAt(Math.floor(Math.random() * letters.length));
    for (let i = 0; i < 4; i++) code += numbers.charAt(Math.floor(Math.random() * numbers.length));
    return code;
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("code").value = generateProductCode();
  });

  document.getElementById('productForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const resultEl = document.getElementById("result");
    resultEl.textContent = "‚è≥ ƒêang x·ª≠ l√Ω ·∫£nh...";
    resultEl.className = "";

    const file = document.getElementById("imageFile").files[0];
    if (!file) {
      resultEl.textContent = "‚ùå Vui l√≤ng ch·ªçn ·∫£nh";
      resultEl.className = "error";
      return;
    }

    const reader = new FileReader();
    reader.onloadend = function () {
      const base64Img = reader.result.split(",")[1];

      const formData = new FormData();
      formData.append("image", base64Img);

      fetch(`https://api.imgbb.com/1/upload?key=${imgbbAPIKey}`, {
        method: "POST",
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        const imageUrl = data.data.url;
        document.getElementById("image").value = imageUrl;
        submitProduct(imageUrl);
      })
      .catch(() => {
        resultEl.textContent = "‚ùå Kh√¥ng th·ªÉ t·∫£i ·∫£nh l√™n. H√£y th·ª≠ l·∫°i.";
        resultEl.className = "error";
      });
    };
    reader.readAsDataURL(file);
  });

  function submitProduct(imageUrl) {
    const resultEl = document.getElementById("result");

    const data = {
      action: "addProduct",
      name: document.getElementById("name").value,
      code: document.getElementById("code").value,
      price: document.getElementById("price").value,
      discount: document.getElementById("discount").value,
      type: document.getElementById("type").value,
      gender: document.getElementById("gender").value,
      material: document.getElementById("material").value,
      image: imageUrl
    };

    fetch("https://script.google.com/macros/s/AKfycbycHXzcZzUxD5V6Po311fgxOi9SF0OCw20Lo5lx5PQnokKW48c7j8v2e74Sz-QvqNOYlw/exec", {
      method: "POST",
      body: new URLSearchParams(data)
    })
    .then(res => res.json())
    .then(response => {
      if (response.status === "success") {
        resultEl.textContent = "‚úÖ " + response.message;
        resultEl.className = "success";
        document.getElementById("productForm").reset();
        document.getElementById("code").value = generateProductCode();
      } else {
        resultEl.textContent = "‚ùå " + response.message;
        resultEl.className = "error";
      }
    })
    .catch(error => {
      console.error("L·ªói:", error);
      resultEl.textContent = "‚ùå ƒê√£ x·∫£y ra l·ªói khi g·ª≠i d·ªØ li·ªáu.";
      resultEl.className = "error";
    });
  }
</script>
</body>
</html>
