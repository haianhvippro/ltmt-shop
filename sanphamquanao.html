<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Danh s√°ch s·∫£n ph·∫©m</title>
  <link rel="stylesheet" href="sanphamquanao.css">
</head>
<body>
  <div class="container">
    <h1>üõçÔ∏è S·∫£n ph·∫©m qu·∫ßn √°o</h1>

    <!-- B·ªô l·ªçc -->
    <div class="filters">
      <input type="text" id="searchInput" placeholder="üîç T√¨m s·∫£n ph·∫©m..." onkeyup="filterProducts()">
      <select id="typeFilter" onchange="filterProducts()">
        <option value="">-- Lo·∫°i s·∫£n ph·∫©m --</option>
        <option value="√°o">√Åo</option>
        <option value="qu·∫ßn">Qu·∫ßn</option>
        <option value="v√°y">V√°y</option>
        <option value="ƒë·∫ßm">ƒê·∫ßm</option>
      </select>
      <select id="genderFilter" onchange="filterProducts()">
        <option value="">-- Gi·ªõi t√≠nh --</option>
        <option value="nam">Nam</option>
        <option value="n·ªØ">N·ªØ</option>
        <option value="tr·∫ª em">Tr·∫ª em</option>
      </select>
      <select id="materialFilter" onchange="filterProducts()">
        <option value="">-- Lo·∫°i v·∫£i --</option>
        <option value="cotton">Cotton</option>
        <option value="lenin">Lenin</option>
        <option value="l·ª•a">L·ª•a</option>
        <option value="jeans">Jeans</option>
        <option value="n·ªâ">N·ªâ</option>
      </select>
    </div>

    <!-- L∆∞·ªõi s·∫£n ph·∫©m -->
    <div class="product-grid" id="productGrid">
      <p>ƒêang t·∫£i s·∫£n ph·∫©m...</p>
    </div>
  </div>

  <!-- Gi·ªè h√†ng -->
  <div id="cart-icon" onclick="toggleCart()">üõí (<span id="cart-count">0</span>)</div>
  <div id="cart-popup" class="hidden">
    <h2>üõí Gi·ªè h√†ng c·ªßa b·∫°n</h2>
    <div id="cart-items"></div>
    <p class="total">T·ªïng: <span id="cart-total">0ƒë</span></p>
    <button onclick="clearCart()">üßπ X√≥a gi·ªè h√†ng</button>
    <a href="thanhtoan.html" onclick="prepareCheckout()" class="checkout-button">üí≥ Thanh to√°n</a>
  </div>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbycHXzcZzUxD5V6Po311fgxOi9SF0OCw20Lo5lx5PQnokKW48c7j8v2e74Sz-QvqNOYlw/exec?action=getProducts';

    async function loadProducts() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();

        if (Array.isArray(data)) {
          renderProducts(data);
        } else {
          document.getElementById("productGrid").innerHTML = "<p>Kh√¥ng th·ªÉ t·∫£i s·∫£n ph·∫©m.</p>";
        }
      } catch (err) {
        document.getElementById("productGrid").innerHTML = "<p>L·ªói khi t·∫£i s·∫£n ph·∫©m.</p>";
        console.error(err);
      }
    }

    function renderProducts(products) {
      const grid = document.getElementById("productGrid");
      grid.innerHTML = "";

      products.forEach(product => {
        const original = product.discount ? `<span class="original-price">${Number(product.price).toLocaleString("vi-VN")}ƒë</span>` : "";
        const sale = `<span class="sale-price">${Number(product.discount || product.price).toLocaleString("vi-VN")}ƒë</span>`;

        const card = document.createElement("div");
        card.className = "product-card";
        card.setAttribute("data-type", product.type.toLowerCase());
        card.setAttribute("data-gender", product.gender.toLowerCase());
        card.setAttribute("data-material", product.material.toLowerCase());

        card.innerHTML = `
          <img src="${product.image}" alt="${product.name}">
          <h2>${product.name}</h2>
          <p class="code">M√£: ${product.code}</p>
          <p class="price">${original} ${sale}</p>
          <button class="add-to-cart">üõí Th√™m v√†o gi·ªè</button>
        `;

        card.querySelector(".add-to-cart").addEventListener("click", () => {
          const name = product.name;
          const code = product.code;
          const price = parseInt(product.discount || product.price);
          cart.push({ name, code, price });
          updateCartUI();
        });

        grid.appendChild(card);
      });

      filterProducts();
    }

    function filterProducts() {
      const searchText = document.getElementById("searchInput").value.toLowerCase();
      const type = document.getElementById("typeFilter").value.toLowerCase();
      const gender = document.getElementById("genderFilter").value.toLowerCase();
      const material = document.getElementById("materialFilter").value.toLowerCase();
      const products = document.querySelectorAll(".product-card");

      products.forEach(product => {
        const name = product.querySelector("h2").textContent.toLowerCase();
        const productType = product.getAttribute("data-type");
        const productGender = product.getAttribute("data-gender");
        const productMaterial = product.getAttribute("data-material");

        const matchesSearch = name.includes(searchText);
        const matchesType = !type || productType === type;
        const matchesGender = !gender || productGender === gender;
        const matchesMaterial = !material || productMaterial === material;

        product.style.display = matchesSearch && matchesType && matchesGender && matchesMaterial ? "flex" : "none";
      });
    }

    // Gi·ªè h√†ng
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    function updateCartUI() {
      const cartCount = document.getElementById("cart-count");
      const cartItems = document.getElementById("cart-items");
      const cartTotal = document.getElementById("cart-total");

      cartCount.textContent = cart.length;

      let html = "";
      let total = 0;

      cart.forEach(item => {
        html += `<div><strong>${item.name}</strong><br>M√£: ${item.code}<br>Gi√°: ${item.price.toLocaleString("vi-VN")}ƒë</div>`;
        total += item.price;
      });

      cartItems.innerHTML = html;
      cartTotal.textContent = total.toLocaleString("vi-VN") + "ƒë";
      localStorage.setItem("cart", JSON.stringify(cart));
    }

    function toggleCart() {
      document.getElementById("cart-popup").classList.toggle("hidden");
    }

    function clearCart() {
      cart = [];
      updateCartUI();
    }

    function prepareCheckout() {
      localStorage.setItem("cart", JSON.stringify(cart));
    }

    // M·∫≠t kh·∫©u ƒë·ªÉ v√†o trang ƒëƒÉng s·∫£n ph·∫©m
    document.querySelector("h1").addEventListener("click", function () {
      const pass = prompt("");
      if (pass === "mongthulythi14011982") {
        window.location.href = "dangsanpham.html";                                                                      //(passssssssss)(mongthulythi14011982)
      } else if (pass !== null) {
        alert("kh√¥ng c√≥ g√¨ h·∫øt h√£y tho√°t ra!");
      }
    });

    loadProducts();
    updateCartUI();
  </script>
</body>
</html>
